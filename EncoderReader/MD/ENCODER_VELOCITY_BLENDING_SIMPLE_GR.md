# Υπεραπλή Εξήγηση: Πώς Βγάζω Τελική Ταχύτητα από τον Encoder

Στόχος: Να το διαβάζει κάποιος χωρίς βαθιά γνώση και να καταλαβαίνει το "γιατί".

---
## 1. Τι έχω
- Έναν encoder που δίνει σήματα A και B.
- Το ESP32 μετράει πόσα βήματα (counts) περνάνε και κάθε πότε.

## 2. Δύο τρόποι να δω πόσο γρήγορα γυρίζει
1. Μέσος όρος σε μικρό χρονικό παράθυρο (π.χ. κάθε 10 ms): "Πόσοι παλμοί πέρασαν μέσα σε αυτά τα 10 ms;" → Window ταχύτητα.
2. Πόσος χρόνος πέρασε από την προηγούμενη ακμή μέχρι την τωρινή; → Edge ταχύτητα (στιγμιαία).

## 3. Τι καλό έχει ο καθένας
| Μέθοδος | Πλεονέκτημα | Πρόβλημα |
|---------|-------------|----------|
| Window  | Σταθερό νούμερο, δεν τρεμοπαίζει | Αργεί λίγο να αλλάξει |
| Edge    | Αντιδρά αμέσως σε αλλαγές | "Πετάγεται"/θορυβώδης σε χαμηλές ταχύτητες |

## 4. Γιατί τις συνδυάζω
Θέλω και σταθερότητα και γρήγορη αντίδραση. Άρα:
- Πολύ αργά → μόνο Window (το Edge θα ήταν τυχαίο).
- Πολύ γρήγορα → περισσότερο Edge (γιατί θέλω άμεσο νούμερο).
- Στη μέση → μίξη των δύο.

## 5. Πώς αποφασίζει (κανόνας)
- Αν η ταχύτητα (window) < 10 cps → πάρε μόνο Window.
- Αν > 1000 cps → 70% Edge + 30% Window.
- Αλλιώς → περίπου 50% - 50% (ό,τι υπάρχει διαθέσιμο).

## 6. Τελικό φιλτράρισμα
Περνάει κι από ένα απλό φίλτρο (EMA) για να μην αλλάζει απότομα στην οθόνη.

## 7. Τι βγαίνει τελικά
- Pos = συνολικά βήματα (counts)
- cps = τελική φιλτραρισμένη ταχύτητα (counts per second)
- rpm = cps / countsPerRev * 60

( countsPerRev = 4 * PPR αν μετράμε και τις 4 ακμές )

## 8. Μικρό παράδειγμα
Σε 10 ms πέρασαν 256 counts:
- Window = 256 / 0.010 = 25600 cps.
- Μια ακμή ήρθε μετά από 39 μs από την προηγούμενη → Edge ≈ 25641 cps.
- Είναι πολύ γρήγορα → Παίρνω 70% * 25641 + 30% * 25600 ≈ 25629 cps.
- Το φίλτρο το λειαίνει ελαφρά.

## 9. Αν ήμουν πολύ αργά
Σε 10 ms πέρασαν 2 counts → 200 cps (<1000). Edge ασταθές → μίξη ή μόνο Window.

## 10. TL;DR
Μετράω pulses σε παράθυρο + χρόνο ανά ακμή.  Κανόνας επιλέγει μίξη.  Φίλτρο λειαίνει.  Τελικά δείχνω την ομαλή ταχύτητα.
